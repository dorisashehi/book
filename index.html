<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">

    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">

    <title>My library</title>

    <link rel="stylesheet" href="./assets/style/main.css">

    <script>

        const myLibrary = []; //array to save books added


        function Book(title, author, pages, description, read = false){
            this.title = title
            this.author = author
            this.pages = pages
            this.description = description
            this.read = read
        }

        Book.prototype.toggleReadStatus = function () { //function to change status
            this.read = !this.read
        }

        function seedBooks(){ //function test to add some fake books
            myLibrary.push(
                new Book("Hobbit", "J.R.R. Tolkien", 29, "Lorem Ipsum is simply dummy text of the printing and typesetting industry. Lorem Ipsum has been the "),
                new Book("New Storem", "Cicero", 295, "There are many variations of passages of Lorem Ipsum available, but the majority have suffered alter"),
                new Book("Lorem Ipsum ", "Richard", 500, "Lorem Ipsum comes from sections 1.10.32 and 1.10.33 of de Finibus Bonorum et Malorum (The Extremes o")
            )
        }

        function loadBooks(){ //function to loaf books
            const bookContainer = document.querySelector(".line");
            var content = ""

            if(myLibrary.length > 0)
            {
                content = myLibrary.map((book, index) => getColumns(book, index)).join('')
            }
            else{
                const emptyContent = document.createElement("div")
                emptyContent.classList.add("error")
                emptyContent.textContent = "No books available! Add a new one."
                content = emptyContent.innerHTML
            }
            bookContainer.innerHTML = content
            addEventListeners()
        }

        function getColumns(book, index){ //function to get books in columns

            return(
                `
                    <div class="col-lg-4 col-md-6 col-sm-12 column pb-3 max-h-96">

                        <div class="card mb-3" style="max-width: 540px; height: 100%;">
                            <div class="row g-0 h-100">
                                <div class="remove-icon" data-getid="${index}">
                                    <i class="fas fa-remove" alt="Remove Book"></i>
                                </div>
                                <div class="col-md-4 col-sm-12">
                                    <img src="./assets/images/book.jpg" alt="Trendy Pants and Shoes" class="img-fluid rounded-start">
                                </div>
                                <div class="col-md-8 col-sm-12 p-lg-0">
                                    <div class="card-body pl-lg-0 pl-sm-3 pr-lg-5 pr-sm-3">
                                        <h5 class="card-title"><b>${book.title}</b></h5>
                                        <p class="card-text">
                                            <b>By:</b> ${book.author}
                                        </p>
                                        <p class="card-text card-description">
                                            <span>${book.description}</span>
                                        </p>
                                        <div class="form-check">
                                            <input type="checkbox" class="form-check-input" id="status" ${(book.read)? "checked" : ""} name="status" data-id="${index}">
                                            <label class="form-check-label" for="status">Mark as read</label>
                                        </div>
                                        <p class="card-text">
                                            <small class="text-muted">${book.pages} pages</small>
                                        </p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                `
            )

        }


        function addEventListeners() { //listeners to change status and remove books
            getRemoveCard();
            changeStatus();
        }

        function getRemoveCard(){ //function to remove a book
            const removeBtn = document.querySelectorAll(".remove-icon");
            Array.from(removeBtn).map((btn) => {
                btn.addEventListener("click", () => {
                    const id = btn.getAttribute('data-getid')
                    myLibrary.splice(id, 1);
                    loadBooks()
                })
            })
        }

        function changeStatus(){ //function to change the status of the book
            const statusCheck = document.querySelectorAll('.card-body #status')
            Array.from(statusCheck).map((checkbox, index) => {
                checkbox.addEventListener('click', () => {
                    myLibrary[index].toggleReadStatus()
                    loadBooks() //refresh
                })
            })
        }


        function addNewBook(){ //function to add a book

            const dialog = document.getElementById("dialog");
            const submitBtn = document.getElementById("submit");
            const form = dialog.querySelector("form")
            let errors = [];
            let isRead = false;

            const status = form.elements["status"];
            status.addEventListener("click", () => isRead = !isRead); //change read to not read

            const inputs = [title, author, pages, description]; //input fields
            inputs.map((item) => { //on value change
                item.addEventListener("input", () => { //validate input fields on change input
                    validateInputs(item, errors)
                })
            })

            submitBtn.addEventListener("click", (e) => { //on button click

                errors = [];
                if( title.value !== '' &&
                    author.value !== '' &&
                    pages.value !== '' &&
                    description.value !== '' &&
                    status.value !== '' &&
                    errors.length == 0
                ){
                    myLibrary.push(new Book(title.value,author.value,pages.value,description.value,isRead))
                    loadBooks() //refresh withouts loading
                    removeErrors(inputs);
                }
                else{
                    e.preventDefault();
                    showErrors(inputs)
                }
            });

            const closeDialog = dialog.querySelector("#js-close");
            closeDialog.addEventListener("click", (e) => { //close dialog box
                e.preventDefault();
                dialog.close();
            });

        }
        function openDialogBox(){ //function to open the dialog box
            const openDialog = document.getElementById("open-dialog");
            openDialog.addEventListener("click", () => {
                dialog.showModal()
            })
        }


        function validateInputs(item, index){ //function to validate input fields of dialog box

            const textRegExp =  /^[a-zA-Z]/;
            let elementError = item.nextElementSibling;
            let error = true;

            if (item.name == "pages" &&  item.value > 0) error = false;
            if(textRegExp.test(item.value)) error = false;

            if(error) {
                elementError.classList.add("error"); errors.push(item)
            }
            else  elementError.classList.remove("error")

        }

        function showErrors(inputs){ //function to show errors
            inputs.map((item) => {
                if(item.value === '') item.nextElementSibling.classList.add("error")
            })
        }

        function removeErrors(inputs){ //function to remove errors
            errors = []; //remove errors
            inputs.map((item) => {
                if(item.value === '') item.nextElementSibling.classList.remove("error");
                item.value = ''
            })
        }

        document.addEventListener("DOMContentLoaded", () => { //main function
            const dialog = document.getElementById("dialog");
            seedBooks()  //defaut values
            loadBooks()  //load all books
            addNewBook() //add new book
            openDialogBox() //open dialog box
        });

    </script>
</head>
<body>
    <header>

        <nav class="navbar navbar-expand-lg bg-body fixed-top">
            <div class="container-fluid">
                <i>My library</i>
            </div>
        </nav>
    </header>
    <div class="container mb-6">
        <div class="row col-12 mb-3">
            <h1></h1>
            <div class="row col-12 row-actions">
                <!-- Button trigger modal -->
                <button type="button" class="btn btn-primary" id="open-dialog">
                    Add New
                </button>
            </div>
        </div>
        <div class="row col-12 g-3 line"></div>
        <!-- Modal -->
        <dialog id="dialog">
            <form method="dialog">
                <div class="form-group">
                    <label for="title">Title*</label>
                    <input type="text" class="form-control" id="title" name="title" placeholder="Enter title" required>
                    <em class="title-error pt-2">Put a valid name (text only)</em>
                </div>
                <div class="form-group">
                    <label for="author">Author*</label>
                    <input type="text" class="form-control" id="author" name="author" placeholder="Enter author" required>
                    <em class="author-error pt-2">Put a valid author (text only)</em>
                </div>
                <div class="form-group">
                    <label for="pages">Pages*</label>
                    <input type="number" class="form-control" id="pages" name="pages" placeholder="Enter Pages" required>
                    <em class="pages-error pt-2">Put a valid number of pages</em>
                </div>
                <div class="form-group">
                    <label for="title">Description*</label>
                    <textarea class="form-control" id="description" name="description" rows="5" maxlength="100" required></textarea>
                    <em class="description-error pt-2">Put a valid description (text only)</em>
                </div>
                <div class="form-check">
                    <input type="checkbox" class="form-check-input" id="status" name="status">
                    <label class="form-check-label" for="status">Mark as read</label>
                </div>
                <div class="mt-4">
                    <input type="submit" id="submit" value="Submit" class="btn btn-primary" formnovalidate />
                    <input type="submit" class="btn btn-primary" id="js-close" value="Close" />
                </div>
            </form>
        </dialog>
    </div>
    <footer class="bg-body-tertiary text-center text-lg-start">
        <div class="text-center p-3" style="background-color: rgba(0, 0, 0, 0.05);">
          © 2024 MyLibrary.com
        </div>
    </footer>
</body>
</html>