<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">

    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">

    <title>Books</title>

    <link rel="stylesheet" href="./assets/style/main.css">

    <script>

        const myLibrary = [];

        function Book(title, author, pages, description, read = false){
            this.title = title
            this.author = author
            this.pages = pages
            this.description = description
            this.read = read
        }

        Book.prototype.setStatus = function (read) {
            this.read = (read) ? true : false
        }

        Book.prototype.getStatus = function(){
            return this.read
        }

        function seedBooks(){
            var book1 = new Book("Hobbit", "J.R.R. Tolkien", 29, "Lorem Ipsum is simply dummy text of the printing and typesetting industry. Lorem Ipsum has been the industry's standard dummy text ever since the 1500s, when an unknown printer took a galley of type and scrambled it to make a type specimen book. ");
            //book1.setStatus(false)
            console.log(book1.getStatus())

            var book2 = new Book("New Storem", "J.R.R. Tolkien", 295, "Lorem Ipsum is simply dummy text of the printing and typesetting industry. Lorem Ipsum has been the industry's standard dummy text ever since the 1500s, when an unknown printer took a galley of type and scrambled it to make a type specimen book. ")
            //book2.setStatus(true)
            console.log(book2.getStatus())

            myLibrary.push(book1, book2)
        }

        function loadBooks(){
            const row = document.querySelector(".line");
            var content = ""

            if(myLibrary.length > 0)
            {
                content = myLibrary.map((book, index) => getColumns(book, index)).join('')
            }
            else{
                const emptyContent = document.createElement("div")
                emptyContent.classList.add("error")
                emptyContent.textContent = "No books available! Add a new one."
                content = emptyContent.innerHTML
                console.log(content)
            }
            row.innerHTML = content
            getRemoveCard() //add listeners for remove button
            changeStatus()
        }

        function getColumns(book, index){

            return(
                `
                    <div class="col-lg-4">

                        <div class="card mb-3" style="max-width: 540px; height: 100%;">
                            <div class="row g-0">
                                <div class="col-md-4">
                                    <img src="./assets/images/book.jpg" alt="Trendy Pants and Shoes" class="img-fluid rounded-start">
                                </div>
                                <div class="col-md-8 p-0">
                                    <div class="remove-icon" data-getid="${index}">
                                        <i class="fas fa-remove" title="Remove Book"></i>
                                    </div>
                                    <div class="card-body">
                                        <h5 class="card-title">${book.title}</h5>
                                        <p class="card-text">
                                            <b>By:</b> ${book.author}
                                        </p>
                                        <p class="card-text">
                                            <span>${book.description}</span>
                                        </p>
                                        <div class="form-check">
                                            <input type="checkbox" class="form-check-input" id="status" ${(book.read)? "checked" : ""} name="status" data-id="${index}">
                                            <label class="form-check-label" for="status">Mark as read</label>
                                        </div>
                                        <p class="card-text">
                                            <small class="text-muted">${book.pages} pages</small>
                                        </p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                `
            )

        }

        function getRemoveCard(){
            const removeBtn = document.querySelectorAll(".remove-icon");

            Array.from(removeBtn).map((btn) => {
                btn.addEventListener("click", () => {

                    const id = btn.getAttribute('data-getid')
                    myLibrary.splice(id, 1);
                    loadBooks()
                    console.log(myLibrary)
                })
            })

        }


        function addNewBook(){
            const dialog = document.getElementById("dialog");
            const closeDialog = dialog.querySelector("#js-close");
            const openDialog = document.getElementById("open-dialog");
            const submitBtn = document.getElementById("submit");
            const inputs = dialog.querySelectorAll("input");
            const form = dialog.querySelector("form")

            openDialog.addEventListener("click", () => dialog.showModal())

            closeDialog.addEventListener("click", (e) => {
                e.preventDefault();
                dialog.close();
            });

            submitBtn.addEventListener("click", (e) => {

                console.log(form.elements["status"].value)
                let inputValues = {
                    title: form.elements["title"].value,
                    author: form.elements["author"].value,
                    pages: form.elements["pages"].value,
                    description: form.elements["description"].value,
                    read: form.elements["status"].hasAttribute("checked") ? true : false

                }
                myLibrary.push(new Book(inputValues.title, inputValues.author, inputValues.pages, inputValues.description, inputValues.read))
                loadBooks() //refresh withouts loading
            });

        }

        function changeStatus(){
            const statusCheck = document.querySelectorAll('.card-body #status')

            Array.from(statusCheck).map((checkbox) => {
                checkbox.addEventListener('click', () => {

                    let bookID = checkbox.getAttribute('data-id')
                    if(!myLibrary[bookID].getStatus()) {
                        myLibrary[bookID].setStatus(true)
                    }else{
                        myLibrary[bookID].setStatus(false)
                    }
                    loadBooks() //refresh
                })
            })

        }


        document.addEventListener("DOMContentLoaded", () => {
            seedBooks()  //defaut values
            loadBooks()  //load all books
            addNewBook() //add new book
        });



    </script>
</head>
<body>

    <div class="container">
        <div class="row col-12 mb-5">
            <h1></h1>
            <div class="row col-12">
                <!-- Button trigger modal -->
                <button type="button" class="btn btn-primary" id="open-dialog">
                    Add New
                </button>
            </div>
        </div>
        <div class="row col-12 g-3 line"></div>
        <!-- Modal -->
        <dialog id="dialog">
            <form method="dialog">
                <div class="form-group">
                    <label for="title">Title</label>
                    <input type="text" class="form-control" id="title" name="title" placeholder="Enter title" required>
                </div>
                <div class="form-group">
                    <label for="title">Author</label>
                    <input type="text" class="form-control" id="author" name="author" placeholder="Enter author" required>
                </div>
                <div class="form-group">
                    <label for="title">Pages</label>
                    <input type="number" class="form-control" id="pages" name="pages" placeholder="Enter Pages" required>
                </div>
                <div class="form-group">
                    <label for="title">Description</label>
                    <textarea class="form-control" id="description" name="description" rows="5" required></textarea>
                </div>
                <div class="form-check">
                    <input type="checkbox" class="form-check-input" id="status" name="status" required>
                    <label class="form-check-label" for="status">Mark as read</label>
                </div>
                <div class="mt-4">
                    <input type="submit" id="submit" value="Submit" class="btn btn-primary" formnovalidate />
                    <input type="submit" class="btn btn-primary" id="js-close" value="Close" />
                </div>
            </form>
        </dialog>
    </div>

</body>
</html>